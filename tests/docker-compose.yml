version: "3.2"
services:
  # Runs the Hardhat node on an ongoing basis
  contract_node:
    image: ghcr.io/olympusdao/olympus-contracts:${CONTRACTS_DOCKER_TAG}
    # When running using CI, we are likely to define these values through environment variables
    environment:
      - PRIVATE_KEY=${CONTRACT_NODE_PRIVATE_KEY}
      - ALCHEMY_API_KEY=${CONTRACT_NODE_ALCHEMY_API_KEY}
    # But the .env file is more likely for local development
    env_file:
      - .env
    # We use the host mode so that "localhost" can be accessed
    network_mode: host
  frontend:
    image: ghcr.io/olympusdao/olympus-frontend:sha-${GITHUB_SHA}
    depends_on:
      - contract_node
    volumes:
      # Mount the root directory
      - ../:/usr/src/app/
    # We use the host mode so that "localhost" can be accessed
    network_mode: host
